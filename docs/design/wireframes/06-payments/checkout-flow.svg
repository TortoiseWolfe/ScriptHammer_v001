<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 950" width="1200" height="950">
  <defs>
    <linearGradient id="bgGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#0f172a"/>
      <stop offset="100%" style="stop-color:#1e293b"/>
    </linearGradient>
    <linearGradient id="accentGrad" x1="0%" y1="0%" x2="100%">
      <stop offset="0%" style="stop-color:#8b5cf6"/>
      <stop offset="100%" style="stop-color:#d946ef"/>
    </linearGradient>
    <linearGradient id="stripeGrad" x1="0%" y1="0%" x2="100%">
      <stop offset="0%" style="stop-color:#635bff"/>
      <stop offset="100%" style="stop-color:#7a73ff"/>
    </linearGradient>
    <linearGradient id="paypalGrad" x1="0%" y1="0%" x2="100%">
      <stop offset="0%" style="stop-color:#003087"/>
      <stop offset="100%" style="stop-color:#009cde"/>
    </linearGradient>
    <style>
      .heading { fill: #ffffff; font-family: system-ui, sans-serif; font-size: 14px; font-weight: bold; }
      .text-sm { fill: #94a3b8; font-family: system-ui, sans-serif; font-size: 10px; }
      .text-md { fill: #cbd5e1; font-family: system-ui, sans-serif; font-size: 12px; }
      .text-muted { fill: #64748b; font-family: system-ui, sans-serif; font-size: 10px; }
      .annotation { fill: #8b5cf6; font-family: monospace; font-size: 9px; }
    </style>
  </defs>

  <!-- Background -->
  <rect width="1200" height="950" fill="url(#bgGrad)"/>

  <!-- Dot grid pattern -->
  <g opacity="0.03">
    <pattern id="dots" width="30" height="30" patternUnits="userSpaceOnUse">
      <circle cx="15" cy="15" r="1" fill="#fff"/>
    </pattern>
    <rect width="1200" height="950" fill="url(#dots)"/>
  </g>

  <!-- Accent line top -->
  <rect x="0" y="0" width="1200" height="3" fill="url(#accentGrad)"/>

  <!-- Title -->
  <text x="600" y="25" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" font-weight="600" fill="#64748b" letter-spacing="2">CHECKOUT FLOW</text>

  <!-- ==================== STEP 1: CONSENT MODAL ==================== -->
  <g transform="translate(30, 45)">
    <text x="175" y="0" text-anchor="middle" class="text-muted">Step 1: GDPR Consent (FR-018)</text>

    <!-- Background page (dimmed) -->
    <rect x="0" y="15" width="350" height="280" rx="8" fill="#1e293b" stroke="#475569" stroke-width="1" opacity="0.5"/>

    <!-- Modal overlay -->
    <rect x="25" y="50" width="300" height="220" rx="12" fill="#334155" stroke="#8b5cf6" stroke-width="2"/>

    <!-- Modal content -->
    <text x="175" y="80" text-anchor="middle" class="heading" font-size="14">Payment Provider Consent</text>

    <!-- Cookie/Privacy Icon -->
    <circle cx="175" cy="110" r="20" fill="#8b5cf620" stroke="#8b5cf6" stroke-width="1"/>
    <text x="175" y="116" text-anchor="middle" font-size="18">üîí</text>

    <!-- Explanation text -->
    <text x="45" y="150" class="text-md" font-size="11">To process your payment, we need to load</text>
    <text x="45" y="165" class="text-md" font-size="11">scripts from Stripe/PayPal. This allows them</text>
    <text x="45" y="180" class="text-md" font-size="11">to securely handle your card information.</text>

    <!-- Learn more link -->
    <text x="45" y="200" fill="#8b5cf6" font-size="10" text-decoration="underline">Learn more about data collection ‚Üí</text>

    <!-- Buttons -->
    <rect x="45" y="220" width="120" height="36" rx="6" fill="url(#accentGrad)"/>
    <text x="105" y="243" text-anchor="middle" fill="#fff" font-size="11" font-weight="600">Accept</text>

    <rect x="175" y="220" width="120" height="36" rx="6" fill="#475569" stroke="#64748b" stroke-width="1"/>
    <text x="235" y="243" text-anchor="middle" fill="#cbd5e1" font-size="11">Decline</text>
  </g>

  <!-- ==================== STEP 2: PAYMENT FORM ==================== -->
  <g transform="translate(410, 45)">
    <text x="175" y="0" text-anchor="middle" class="text-muted">Step 2: Payment Form (FR-001, FR-002)</text>

    <rect x="0" y="15" width="350" height="280" rx="8" fill="#1e293b" stroke="#475569" stroke-width="1"/>

    <!-- Header -->
    <rect x="0" y="15" width="350" height="40" rx="8" fill="#334155"/>
    <rect x="0" y="47" width="350" height="8" fill="#334155"/>
    <text x="20" y="42" fill="#fff" font-size="12">‚Üê</text>
    <text x="175" y="42" text-anchor="middle" class="heading" font-size="13">Checkout</text>

    <!-- Order Summary -->
    <g transform="translate(15, 70)">
      <text x="0" y="0" class="text-muted" font-size="10">ORDER SUMMARY</text>
      <rect x="0" y="10" width="320" height="50" rx="6" fill="#334155"/>
      <text x="15" y="35" class="text-md">Pro Plan (Monthly)</text>
      <text x="270" y="35" text-anchor="end" fill="#fff" font-size="14" font-weight="bold">$29.00</text>
      <text x="15" y="50" class="text-muted">Billed monthly, cancel anytime</text>
    </g>

    <!-- Payment Method Selection -->
    <g transform="translate(15, 145)">
      <text x="0" y="0" class="text-muted" font-size="10">PAYMENT METHOD</text>

      <!-- Stripe Option (Selected) -->
      <rect x="0" y="15" width="155" height="45" rx="6" fill="#334155" stroke="#8b5cf6" stroke-width="2"/>
      <circle cx="20" cy="37" r="8" fill="#8b5cf6"/>
      <circle cx="20" cy="37" r="4" fill="#fff"/>
      <rect x="40" y="28" width="50" height="18" rx="4" fill="url(#stripeGrad)"/>
      <text x="65" y="41" text-anchor="middle" fill="#fff" font-size="8" font-weight="bold">stripe</text>
      <text x="100" y="42" class="text-sm">Card</text>

      <!-- PayPal Option -->
      <rect x="165" y="15" width="155" height="45" rx="6" fill="#334155" stroke="#475569" stroke-width="1"/>
      <circle cx="185" cy="37" r="8" fill="#475569"/>
      <rect x="205" y="28" width="55" height="18" rx="4" fill="url(#paypalGrad)"/>
      <text x="232" y="41" text-anchor="middle" fill="#fff" font-size="8" font-weight="bold">PayPal</text>
    </g>

    <!-- Card Input Fields -->
    <g transform="translate(15, 215)">
      <rect x="0" y="0" width="320" height="36" rx="6" fill="#0f172a" stroke="#475569" stroke-width="1"/>
      <text x="15" y="23" class="text-muted">4242 4242 4242 4242</text>
      <text x="200" y="23" class="text-muted">MM/YY</text>
      <text x="270" y="23" class="text-muted">CVC</text>
    </g>

    <!-- Pay Button -->
    <rect x="15" y="260" width="320" height="44" rx="8" fill="url(#accentGrad)"/>
    <text x="175" y="287" text-anchor="middle" fill="#fff" font-size="13" font-weight="600">Pay $29.00</text>
  </g>

  <!-- ==================== STEP 3: PROCESSING ==================== -->
  <g transform="translate(790, 45)">
    <text x="175" y="0" text-anchor="middle" class="text-muted">Step 3: Processing</text>

    <rect x="0" y="15" width="350" height="280" rx="8" fill="#1e293b" stroke="#475569" stroke-width="1"/>

    <!-- Processing State -->
    <g transform="translate(100, 100)">
      <!-- Spinner -->
      <circle cx="75" cy="50" r="35" fill="none" stroke="#334155" stroke-width="4"/>
      <path d="M75 15 A35 35 0 0 1 110 50" fill="none" stroke="#8b5cf6" stroke-width="4" stroke-linecap="round">
        <animateTransform attributeName="transform" type="rotate" from="0 75 50" to="360 75 50" dur="1s" repeatCount="indefinite"/>
      </path>

      <text x="75" y="110" text-anchor="middle" class="heading" font-size="14">Processing Payment</text>
      <text x="75" y="130" text-anchor="middle" class="text-muted">Please wait...</text>
    </g>

    <!-- Security Badge -->
    <g transform="translate(100, 230)">
      <rect x="0" y="0" width="150" height="30" rx="6" fill="#22c55e20" stroke="#22c55e" stroke-width="1"/>
      <text x="20" y="20" fill="#22c55e" font-size="12">üîí</text>
      <text x="40" y="20" fill="#22c55e" font-size="10">Secure checkout</text>
    </g>
  </g>

  <!-- ==================== DECLINE FALLBACK (FR-020) ==================== -->
  <g transform="translate(30, 350)">
    <text x="175" y="0" text-anchor="middle" class="text-muted">Consent Declined: Fallback Options (FR-020)</text>

    <rect x="0" y="15" width="350" height="250" rx="8" fill="#1e293b" stroke="#eab308" stroke-width="1"/>

    <!-- Warning Banner -->
    <rect x="0" y="15" width="350" height="40" rx="8" fill="#eab30820"/>
    <rect x="0" y="47" width="350" height="8" fill="#eab30820"/>
    <text x="20" y="42" fill="#eab308" font-size="14">‚ö†Ô∏è</text>
    <text x="45" y="42" fill="#eab308" font-size="11">Card payments require consent</text>

    <!-- Alternative Payment Links -->
    <g transform="translate(20, 75)">
      <text x="0" y="0" class="heading" font-size="12">Alternative Payment Methods</text>
      <text x="0" y="20" class="text-muted">No external scripts required</text>

      <!-- Cash App -->
      <rect x="0" y="40" width="310" height="50" rx="8" fill="#00D632" stroke="none"/>
      <text x="30" y="70" fill="#fff" font-size="16">$</text>
      <text x="55" y="72" fill="#fff" font-size="14" font-weight="bold">Cash App</text>
      <text x="250" y="72" fill="#fff" font-size="11">$yourCashtag ‚Üí</text>

      <!-- Chime -->
      <rect x="0" y="100" width="310" height="50" rx="8" fill="#1EC677" stroke="none"/>
      <text x="30" y="130" fill="#fff" font-size="14">üíö</text>
      <text x="55" y="132" fill="#fff" font-size="14" font-weight="bold">Chime</text>
      <text x="250" y="132" fill="#fff" font-size="11">$yourChime ‚Üí</text>

      <!-- Note -->
      <text x="0" y="175" class="text-muted" font-size="9">Consent will be requested again on your next visit</text>
    </g>
  </g>

  <!-- ==================== SUCCESS STATE ==================== -->
  <g transform="translate(410, 350)">
    <text x="175" y="0" text-anchor="middle" class="text-muted">Step 4: Success (FR-010)</text>

    <rect x="0" y="15" width="350" height="250" rx="8" fill="#1e293b" stroke="#22c55e" stroke-width="1"/>

    <!-- Success Icon -->
    <circle cx="175" cy="90" r="40" fill="#22c55e20" stroke="#22c55e" stroke-width="2"/>
    <text x="175" y="100" text-anchor="middle" font-size="32">‚úì</text>

    <!-- Success Message -->
    <text x="175" y="155" text-anchor="middle" class="heading" font-size="16">Payment Successful!</text>
    <text x="175" y="175" text-anchor="middle" class="text-md">Thank you for your purchase</text>

    <!-- Transaction Details -->
    <rect x="30" y="195" width="290" height="50" rx="6" fill="#334155"/>
    <text x="50" y="217" class="text-muted">Transaction ID:</text>
    <text x="50" y="235" class="text-md" font-size="11">txn_1NqX7J2eZvKYlo2C</text>
    <text x="260" y="220" text-anchor="end" fill="#22c55e" font-size="12">Verified ‚úì</text>
  </g>

  <!-- ==================== OFFLINE STATE (NFR-005) ==================== -->
  <g transform="translate(790, 350)">
    <text x="175" y="0" text-anchor="middle" class="text-muted">Offline Mode (FR-038, NFR-005)</text>

    <rect x="0" y="15" width="350" height="250" rx="8" fill="#1e293b" stroke="#f59e0b" stroke-width="1"/>

    <!-- Offline Banner -->
    <rect x="0" y="15" width="350" height="45" rx="8" fill="#f59e0b20"/>
    <rect x="0" y="52" width="350" height="8" fill="#f59e0b20"/>
    <text x="20" y="45" fill="#f59e0b" font-size="14">üì°</text>
    <text x="45" y="45" fill="#f59e0b" font-size="12">You're offline</text>

    <!-- Queue Status -->
    <g transform="translate(20, 80)">
      <text x="0" y="0" class="heading" font-size="12">Payment Queued</text>
      <text x="0" y="20" class="text-muted">Will process when back online</text>

      <!-- Queued Item -->
      <rect x="0" y="40" width="310" height="60" rx="8" fill="#334155" stroke="#475569" stroke-width="1"/>
      <circle cx="25" cy="70" r="12" fill="#f59e0b20" stroke="#f59e0b" stroke-width="1"/>
      <text x="25" y="75" text-anchor="middle" fill="#f59e0b" font-size="10">‚è≥</text>
      <text x="50" y="62" class="text-md">Pro Plan - $29.00</text>
      <text x="50" y="80" class="text-muted">Waiting for connection...</text>
      <text x="280" y="70" fill="#f59e0b" font-size="10">Queued</text>

      <!-- Progress indicator -->
      <rect x="0" y="115" width="310" height="6" rx="3" fill="#334155"/>
      <rect x="0" y="115" width="0" height="6" rx="3" fill="#f59e0b">
        <animate attributeName="width" values="0;310;0" dur="3s" repeatCount="indefinite"/>
      </rect>
      <text x="0" y="135" class="text-muted" font-size="9">Checking connection...</text>
    </g>
  </g>

  <!-- ==================== MOBILE CHECKOUT ==================== -->
  <g transform="translate(30, 620)">
    <text x="175" y="0" text-anchor="middle" class="text-muted">Mobile Checkout (390px)</text>

    <!-- Phone Frame -->
    <rect x="0" y="15" width="350" height="300" rx="16" fill="#0f172a" stroke="#475569" stroke-width="2"/>

    <!-- Status Bar -->
    <text x="25" y="35" fill="#fff" font-size="9" font-weight="600">9:41</text>
    <text x="310" y="35" fill="#fff" font-size="9">üì∂ üîã</text>

    <!-- Header -->
    <rect x="10" y="45" width="330" height="40" fill="#1e293b"/>
    <text x="30" y="70" fill="#fff" font-size="12">‚Üê</text>
    <text x="175" y="70" text-anchor="middle" class="heading" font-size="12">Checkout</text>

    <!-- Order Summary (Collapsed) -->
    <rect x="20" y="95" width="310" height="40" rx="6" fill="#334155"/>
    <text x="35" y="120" class="text-md">Pro Plan</text>
    <text x="280" y="120" text-anchor="end" fill="#fff" font-size="13" font-weight="bold">$29.00</text>

    <!-- Payment Method Tabs -->
    <g transform="translate(20, 145)">
      <rect x="0" y="0" width="310" height="36" rx="8" fill="#0f172a"/>
      <rect x="4" y="4" width="100" height="28" rx="6" fill="#8b5cf6"/>
      <text x="54" y="24" text-anchor="middle" fill="#fff" font-size="10" font-weight="600">Card</text>
      <text x="157" y="24" text-anchor="middle" class="text-muted" font-size="10">PayPal</text>
      <text x="260" y="24" text-anchor="middle" class="text-muted" font-size="10">Other</text>
    </g>

    <!-- Card Input (Stacked on Mobile) -->
    <g transform="translate(20, 195)">
      <rect x="0" y="0" width="310" height="40" rx="6" fill="#334155" stroke="#475569" stroke-width="1"/>
      <text x="15" y="25" class="text-muted">Card number</text>

      <rect x="0" y="50" width="150" height="40" rx="6" fill="#334155" stroke="#475569" stroke-width="1"/>
      <text x="15" y="75" class="text-muted">MM/YY</text>

      <rect x="160" y="50" width="150" height="40" rx="6" fill="#334155" stroke="#475569" stroke-width="1"/>
      <text x="175" y="75" class="text-muted">CVC</text>
    </g>

    <!-- Bottom Sheet CTA -->
    <rect x="10" y="265" width="330" height="45" rx="10" fill="url(#accentGrad)"/>
    <text x="175" y="293" text-anchor="middle" fill="#fff" font-size="14" font-weight="600">Pay $29.00</text>
  </g>

  <!-- ==================== ANNOTATIONS ==================== -->

  <!-- Consent Modal Annotation -->
  <g transform="translate(410, 620)">
    <rect x="0" y="0" width="180" height="65" rx="4" fill="#8b5cf610" stroke="#8b5cf6" stroke-width="1" stroke-dasharray="3,3"/>
    <text x="10" y="18" class="annotation">üîí GDPR Consent (FR-018)</text>
    <text x="10" y="32" class="text-muted" font-size="8">Required before loading any</text>
    <text x="10" y="44" class="text-muted" font-size="8">payment provider scripts</text>
    <text x="10" y="56" class="text-muted" font-size="8">(Stripe, PayPal external JS)</text>
  </g>

  <!-- Fallback Options Annotation -->
  <g transform="translate(410, 695)">
    <rect x="0" y="0" width="180" height="55" rx="4" fill="#8b5cf610" stroke="#8b5cf6" stroke-width="1" stroke-dasharray="3,3"/>
    <text x="10" y="18" class="annotation">üíµ No-Script Fallbacks</text>
    <text x="10" y="32" class="text-muted" font-size="8">Cash App + Chime links work</text>
    <text x="10" y="44" class="text-muted" font-size="8">without external scripts</text>
  </g>

  <!-- Webhook Verification Annotation -->
  <g transform="translate(600, 620)">
    <rect x="0" y="0" width="180" height="65" rx="4" fill="#8b5cf610" stroke="#8b5cf6" stroke-width="1" stroke-dasharray="3,3"/>
    <text x="10" y="18" class="annotation">‚úì Webhook Verification</text>
    <text x="10" y="32" class="text-muted" font-size="8">Payment marked "Verified"</text>
    <text x="10" y="44" class="text-muted" font-size="8">only after webhook confirms</text>
    <text x="10" y="56" class="text-muted" font-size="8">(FR-007, FR-010)</text>
  </g>

  <!-- Offline Queue Annotation -->
  <g transform="translate(600, 695)">
    <rect x="0" y="0" width="180" height="55" rx="4" fill="#8b5cf610" stroke="#8b5cf6" stroke-width="1" stroke-dasharray="3,3"/>
    <text x="10" y="18" class="annotation">üì° Offline-First Queue</text>
    <text x="10" y="32" class="text-muted" font-size="8">IndexedDB persistence</text>
    <text x="10" y="44" class="text-muted" font-size="8">Auto-sync when online (FR-039)</text>
  </g>

  <!-- Mobile Touch Target Annotation -->
  <g transform="translate(790, 620)">
    <rect x="0" y="0" width="180" height="55" rx="4" fill="#8b5cf610" stroke="#8b5cf6" stroke-width="1" stroke-dasharray="3,3"/>
    <text x="10" y="18" class="annotation">üëÜ Mobile: 44px+ Targets</text>
    <text x="10" y="32" class="text-muted" font-size="8">All buttons meet WCAG</text>
    <text x="10" y="44" class="text-muted" font-size="8">touch target requirements</text>
  </g>

  <!-- Security Annotation -->
  <g transform="translate(790, 685)">
    <rect x="0" y="0" width="180" height="55" rx="4" fill="#8b5cf610" stroke="#8b5cf6" stroke-width="1" stroke-dasharray="3,3"/>
    <text x="10" y="18" class="annotation">üõ°Ô∏è Security Badges</text>
    <text x="10" y="32" class="text-muted" font-size="8">Stripe handles card data</text>
    <text x="10" y="44" class="text-muted" font-size="8">No PCI scope for template</text>
  </g>

  <!-- Spec Reference -->
  <text x="600" y="935" text-anchor="middle" class="text-muted" font-size="9">Spec: 015-payment-integration ‚Ä¢ FR-018 to FR-020: Consent, FR-038/039: Offline queue, FR-007/FR-010: Webhook verification</text>
</svg>